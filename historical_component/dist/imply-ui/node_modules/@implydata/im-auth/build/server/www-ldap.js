"use strict";Object.defineProperty(exports,"__esModule",{value:true});var es7Shim=require("es7-shim");es7Shim.shim();var debugModule=require("debug");var http=require("http");var immutable_store_1=require("@implydata/immutable-store");var nike_hercules_1=require("@implydata/nike-hercules");var app_1=require("./app");var authorizer_1=require("./authorizer");var PORT=9094;var debug=debugModule("im-auth:www");var server=new nike_hercules_1.HerculesServer;server.decorateReqRes();var userStore=new immutable_store_1.ArrayStore({initArray:[]});var authorizer=new authorizer_1.LDAPAuthorizer({userStore:userStore,ldapOptions:{url:"ldap://192.168.99.100:389",searchBase:"dc=imply,dc=io",searchFilter:"(uid={{username}})",bindDN:"cn=admin,dc=imply,dc=io",bindCredentials:"JonSn0w"},logger:nike_hercules_1.LOGGER});server.getApp().use(function(req,res,next){req.authorizer=authorizer;req.logger=nike_hercules_1.LOGGER;req.tracker=nike_hercules_1.TRACKER;next()});var authApp=app_1.makeAuthApp({version:"1",title:"Login to Standalone Auth (LDAP)",appName:"Standalone Auth (LDAP)",showTerms:true,authorizer:authorizer});server.getApp().use(authApp);server.getApp().use("/",function(req,res,next){var user=req.user;res.send("Welcome "+user.getDisplayName())});var httpServer=http.createServer(server.getApp());httpServer.on("error",function(error){if(error.syscall!=="listen"){throw error}switch(error.code){case"EACCES":console.error("Port "+PORT+" requires elevated privileges");process.exit(1);break;case"EADDRINUSE":console.error("Port "+PORT+" is already in use");process.exit(1);break;default:throw error}});httpServer.on("listening",function(){var address=httpServer.address();console.log("Im auth is listening on address "+address.address+" port "+address.port);debug("Im auth is listening on address "+address.address+" port "+address.port)});httpServer.listen(PORT);