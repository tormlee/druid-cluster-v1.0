"use strict";var path=require("path");var bodyParser=require("body-parser");var nike_hercules_1=require("@implydata/nike-hercules");var mkurlRoutes=require("./routes/mkurl/mkurl");var pivotRoutes=require("./routes/pivot/pivot");var plywoodRoutes=require("./routes/plywood/plywood");var utils_1=require("./utils");var innerApp=new nike_hercules_1.HerculesServer;innerApp.addStaticRoutes([path.join(__dirname,"../../build/public")]);var dataCubeActions=new utils_1.DataCubeActions;var timekeeperCache=new utils_1.TimekeeperCache;innerApp.getApp().use(bodyParser.json({limit:"1mb"}));innerApp.getApp().use(function(e,r,t){var i=e.body.version;if(i&&i!==e.version){r.status(412).send({error:"incorrect version",action:"reload"});return}t()});innerApp.getApp().use(function(e,r,t){var i=e.body.settingsVersion;if(i&&typeof i!=="number"){r.status(400).send({error:"settings version must be a number"});return}e.dataCubeActions=dataCubeActions;e.timekeeperCache=timekeeperCache;t()});innerApp.addRoutes("/plywood",plywoodRoutes);innerApp.addRoutes("/mkurl",mkurlRoutes);innerApp.addRoutes("/",pivotRoutes);module.exports=innerApp;