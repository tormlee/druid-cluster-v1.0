"use strict";Object.defineProperty(exports,"__esModule",{value:true});var path=require("path");var hasOwnProp=require("has-own-prop");var nike_hercules_1=require("@implydata/nike-hercules");var bodyParser=require("body-parser");var launcherRoutes=require("./routes/launcher/launcher");var settingsRoutes=require("./routes/settings/settings");var userRoutes=require("./routes/user/user");var pivot=require("./routes/pivot/pivot");var views_1=require("./views");function makeLauncherServer(e){var r=e.serverConfig,s=e.version,t=e.logoutHref,o=e.homeHref,u=e.simplePivot,i=e.hasSubscription,a=e.appTitle;var n=new nike_hercules_1.HerculesServer({serverRoot:r.getServerRoot()});n.addStaticRoutes([path.join(__dirname,"../../build/public"),path.join(__dirname,"../../assets")]);n.getApp().use(bodyParser.json());n.getApp().use(function(e,r,t){e.version=s;e.simplePivot=u;e.hasSubscription=i;e.appTitle=a;t()});if(!u){n.addRoutes("/pivot",pivot)}n.addRoutes("/settings",settingsRoutes);n.addRoutes("/user",userRoutes);n.addRoutes("/",launcherRoutes);if(r.getIframe()==="deny"){n.getApp().use(function(e,r,s){r.setHeader("X-Frame-Options","DENY");r.setHeader("Content-Security-Policy","frame-ancestors 'none'");s()})}n.getApp().use(function(e,r,s){r.redirect("/")});n.getApp().use(function(e,r,s,t){nike_hercules_1.LOGGER.error("request error: "+r.requestId);if(hasOwnProp(e,"type")&&e.type==="cloudManager"){s.status(e.code).json({error:e.message,info:e.info});return}t(e)});if(n.getApp().get("env")==="development"){n.getApp().use(function(e,r,t,o){nike_hercules_1.LOGGER.error("Server Error: "+e.message);nike_hercules_1.LOGGER.error(e.stack);t.status(e.status||500);t.send(views_1.errorLayout({version:s,title:"Error"},e.message,e))})}n.getApp().use(function(e,r,t,o){nike_hercules_1.LOGGER.error("Server Error: "+e.message);nike_hercules_1.LOGGER.error(e.stack);t.status(e.status||500);t.send(views_1.errorLayout({version:s,title:"Error"},e.message))});return n}exports.makeLauncherServer=makeLauncherServer;