"use strict";var _this=this;var tslib_1=require("tslib");var nike_hercules_1=require("@implydata/nike-hercules");var im_auth_1=require("@implydata/im-auth");var router=nike_hercules_1.HerculesServer.makeRouter();router.post("/set-role",function(e,r){return tslib_1.__awaiter(_this,void 0,void 0,function(){var t,s,a,n;return tslib_1.__generator(this,function(u){switch(u.label){case 0:t=e.rolesStore;s=e.body.role;u.label=1;case 1:u.trys.push([1,3,,4]);return[4,t.addOrUpdate(im_auth_1.Role.fromJS(s))];case 2:u.sent();return[3,4];case 3:a=u.sent();r.status(400).send({error:"Settings update error:",message:a.message});return[2];case 4:return[4,t.getAll()];case 5:n=u.sent();r.send({status:"ok",newRoles:n});return[2]}})})});router.post("/remove-role",function(e,r){return tslib_1.__awaiter(_this,void 0,void 0,function(){var t,s,a,n,u,o,l,i,c,d,_;return tslib_1.__generator(this,function(h){switch(h.label){case 0:t=e.rolesStore,s=e.authorizer;a=e.body.role;h.label=1;case 1:h.trys.push([1,3,,4]);return[4,t.deleteByKey(a)];case 2:h.sent();return[3,4];case 3:n=h.sent();r.status(400).send({error:"Settings update error:",message:n.message});return[2];case 4:h.trys.push([4,10,,11]);return[4,s.getAllUsers()];case 5:u=h.sent();o=u.filter(function(e){return e.getRoles().includes(a)});l=0;h.label=6;case 6:if(!(l<o.length))return[3,9];i=o[l];c=i.getRoles();i=i.changeRoles(c.filter(function(e){return e!==a}));return[4,s.addOrUpdateUser(i)];case 7:h.sent();h.label=8;case 8:l++;return[3,6];case 9:return[3,11];case 10:d=h.sent();r.status(400).send({error:"d update error:",message:d.message});return[2];case 11:return[4,t.getAll()];case 12:_=h.sent();r.send({status:"ok",newRoles:_});return[2]}})})});module.exports=router;