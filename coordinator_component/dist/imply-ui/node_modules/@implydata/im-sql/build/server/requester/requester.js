"use strict";Object.defineProperty(exports,"__esModule",{value:true});var request=require("request-promise-any");var nike_hercules_1=require("@implydata/nike-hercules");var promise_timeout_1=require("promise-timeout");var Agent=require("socks5-http-client/lib/Agent");var Requester=function(){function e(e){this.agentOptions=null;if(e.agentOptions){this.agentOptions=e.agentOptions}}e.prototype.request=function(e,t,r,i){if(i===void 0){i={}}if(!e.method)e.method="POST";if(this.agentOptions){e.agentClass=Agent;e.agentOptions=this.agentOptions}var n={type:"backend-request",metric:"query/time",user:t,attr:Object.assign({url:e.url,method:e.method},i)};if(t&&t.accountId)n.attr["accountId"]=t.accountId;var s=request(e);if(this.agentOptions&&e.timeout){s=promise_timeout_1.timeout(s,e.timeout)}var u=Date.now();return s.then(function(e){n.attr.success="true";n.attr.requestId=r;n.value=Date.now()-u;nike_hercules_1.TRACKER.track(n);return e},function(e){n.attr.success="false";n.attr.requestId=r;n.value=Date.now()-u;nike_hercules_1.TRACKER.track(n);throw e})};return e}();exports.Requester=Requester;