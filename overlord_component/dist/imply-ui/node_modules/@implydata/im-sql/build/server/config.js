"use strict";Object.defineProperty(exports,"__esModule",{value:true});var path=require("path");var fs=require("fs");var nopt=require("nopt");var yaml=require("js-yaml");var beltful_1=require("@implydata/beltful");var nike_hercules_1=require("@implydata/nike-hercules");var PORT=9092;function loadFileSync(e,r){if(r===void 0){r=null}var t=fs.readFileSync(e,"utf-8");if(r==="json"){t=JSON.parse(t)}else if(r==="yaml"){t=yaml.safeLoad(t)}return t}exports.loadFileSync=loadFileSync;function exitWithError(e){console.error(e);process.exit(1)}var PACKAGE_FILE=path.join(__dirname,"../../package.json");var packageObj=null;try{packageObj=loadFileSync(PACKAGE_FILE,"json")}catch(e){exitWithError("Could not read package.json: "+e.message)}exports.VERSION=packageObj.version;function parseArgs(){return nopt({port:Number,config:String,serverHost:String,iframe:String},{p:["--port"],c:["--config"]},process.argv)}var parsedArgs=parseArgs();nike_hercules_1.LOGGER.init();var serverSettingsFilePath=parsedArgs["config"];var anchorPath;var serverSettingsJS;if(serverSettingsFilePath){anchorPath=path.dirname(serverSettingsFilePath);try{serverSettingsJS=beltful_1.StringUtils.inlineVars(loadFileSync(serverSettingsFilePath,"yaml"),process.env);nike_hercules_1.LOGGER.log("Using config "+serverSettingsFilePath)}catch(e){exitWithError("Could not load config from '"+serverSettingsFilePath+"': "+e.message)}}else{anchorPath=process.cwd();serverSettingsJS={}}nike_hercules_1.LOGGER.log("Starting SQL UI v"+exports.VERSION);nike_hercules_1.TRACKER.track({type:"sql-ui-init",metric:"init",value:1});function resolvePath(e){return path.resolve(process.cwd(),e.replace(/\$var/g,path.resolve("var/im-sql")).replace(/\$cwd/g,function(){return process.cwd()}))}serverSettingsJS.getPort=function(){return parsedArgs["port"]||PORT};serverSettingsJS.getServerHost=function(){return parsedArgs["serverHost"]||null};serverSettingsJS.getIframe=function(){return parsedArgs["iframe"]||"allow"};serverSettingsJS.getResolvedDecorators=function(){var e={basicAuth:"basicAuthDecorator.js",union:"unionDecorator.js"};var r={};for(var t in e){r[t]=path.resolve(e[t])}return r};exports.SERVER_SETTINGS=serverSettingsJS;