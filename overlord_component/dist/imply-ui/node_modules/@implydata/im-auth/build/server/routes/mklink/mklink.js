"use strict";var _this=this;var tslib_1=require("tslib");var nike_hercules_1=require("@implydata/nike-hercules");var invite_token_1=require("../../models/invite-token/invite-token");var router=nike_hercules_1.HerculesServer.makeRouter();router.post("/",function(req,res,next){return tslib_1.__awaiter(_this,void 0,void 0,function(){var _a,name,account,token,e_1,e_2,link;return tslib_1.__generator(this,function(_b){switch(_b.label){case 0:_a=req.body,name=_a.name,account=_a.account;if(typeof name!=="string"){res.status(400).send({error:"must have a name"});return[2]}_b.label=1;case 1:_b.trys.push([1,3,,4]);return[4,req.inviteTokenStore.get(name)];case 2:token=_b.sent();return[3,4];case 3:e_1=_b.sent();next(e_1);return[2];case 4:if(!!token)return[3,8];token=invite_token_1.InviteToken.createFor(name);_b.label=5;case 5:_b.trys.push([5,7,,8]);return[4,req.inviteTokenStore.addOrUpdate(token)];case 6:_b.sent();return[3,8];case 7:e_2=_b.sent();next(e_2);return[2];case 8:link=req.protocol+"://"+req.get("Host")+"/invite-user?user="+token.name+"&token="+token.value;if(account)link+="&account="+account;res.send({link:link});return[2]}})})});module.exports=router;