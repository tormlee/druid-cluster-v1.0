"use strict";Object.defineProperty(exports,"__esModule",{value:true});var jsSHA=require("jssha");var escapeRegExp=require("lodash.escaperegexp");var DEFAULT_NEXT_TOKEN=function(){return Math.floor(16*Math.random()).toString(16)};var DEFAULT_MIN_TOKENS=4;var nativeToString=Object.prototype.toString;exports.StringUtils={firstUp:function(str){return str?str.charAt(0).toUpperCase()+str.slice(1):undefined},inlineVars:function(obj,vs){return JSON.parse(JSON.stringify(obj).replace(/%\{[\w\-]+\}%/g,function(varName){varName=varName.substr(2,varName.length-4);var v=vs[varName];if(typeof v!=="string")throw new Error("could not find variable '"+varName+"'");v=JSON.stringify(v);return v.substr(1,v.length-2)}))},pluralIfNeeded:function(n,thing){return n+" "+thing+(n===1?"":"s")},makeUrlSafeName:function(name){return name.replace(/\s+/g,"_").replace(/[^\w.~\-]+/g,"-").substr(0,140)},makeUrlSafeTitle:function(name){return name.replace(/\s+/g,"_").replace(/[%#<>[\]|{}]+/g,"-").replace(/--+/g,"-").replace(/[_-]_+/g,"_").replace(/_+[_-]/g,"_").replace(/^[_-]+|[_-]+$/g,"").substr(0,140)},makeNameFromFormula:function(formula){return formula.replace(/^[.()$-_]+/g,"").replace(/[.()$-_]+$/g,"").replace(/(\.|\(|\)|\$|\-|\_)+/g,"-")},verifyUrlSafeName:function(name){if(typeof name!=="string")throw new TypeError("name must be a string");if(!name.length)throw new Error("can not have empty name");var urlSafeName=exports.StringUtils.makeUrlSafeName(name);if(name!==urlSafeName){throw new Error("'"+name+"' is not a URL safe name. Try '"+urlSafeName+"' instead?")}},makeTitle:function(name){return name.replace(/^[ _\-]+|[ _\-]+$/g,"").replace(/(^|[_\-]+)\w/g,function(s){return s.replace(/[_\-]+/," ").toUpperCase()}).replace(/[a-z0-9][A-Z]/g,function(s){return s[0]+" "+s[1]})},generateAvailableName:function(options){if(options===void 0){options={}}var _a=options.prefix,prefix=_a===void 0?"":_a,_b=options.isAvailable,isAvailable=_b===void 0?function(){return true}:_b,_c=options.minTokens,minTokens=_c===void 0?DEFAULT_MIN_TOKENS:_c,_d=options.nextToken,nextToken=_d===void 0?DEFAULT_NEXT_TOKEN:_d,allowRawPrefix=options.allowRawPrefix,_e=options.separator,separator=_e===void 0?"":_e;if(allowRawPrefix&&isAvailable(prefix))return prefix;var name;var tryNumber=0;do{name=prefix+separator;var length_1=minTokens+tryNumber/3;for(var i=0;i<length_1;i++)name=name+nextToken();tryNumber++}while(!isAvailable(name));return name},consistentReplacer:function(k,value){if(nativeToString.call(value)==="[object Object]"){var keys=Object.keys(value);if(keys.length>1){var array=["!flat_array!"];for(var _i=0,keys_1=keys;_i<keys_1.length;_i++){var key=keys_1[_i];array.push(key,value[key])}return array}}return value},tidyB64:function(b64){return b64.replace(/\+/g,"-").replace(/\//g,"_")},untidyB64:function(b64){return b64.replace(/-/g,"+").replace(/_/g,"/")},objectHash:function(object){var shaObj=new jsSHA("SHA-1","TEXT");shaObj.update(JSON.stringify(object,exports.StringUtils.consistentReplacer));return shaObj.getHash("HEX")},objectHashHex18:function(object){return exports.StringUtils.objectHash(object).substr(0,18)},emphasizeText:function(text,em){if(!em)return text;em=escapeRegExp(em);var bits=em.split(/\s+/).sort(function(a,b){return b.length-a.length});var tokens={};bits.forEach(function(bit,i){var regExp=new RegExp(bit,"gi");if(text.search(regExp)===-1)return;text.match(regExp).forEach(function(match,j){var key="__BIT-"+i+"-"+j+"__";text=text.replace(match,key);tokens[key]=match})});for(var key in tokens){text=text.replace(new RegExp(key,"g"),"<em>"+tokens[key]+"</em>")}return text}};