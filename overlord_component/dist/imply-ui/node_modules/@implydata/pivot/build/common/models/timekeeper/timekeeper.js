"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");var immutable_class_1=require("immutable-class");var time_tag_1=require("../time-tag/time-tag");var Timekeeper=function(e){tslib_1.__extends(t,e);function t(t){return e.call(this,t)||this}t.isTimekeeper=function(e){return e instanceof t};t.globalNow=function(){return new Date};t.fromJS=function(e){return new t(immutable_class_1.BaseImmutable.jsToValue(t.PROPERTIES,e))};t.prototype.now=function(){return this.nowOverride||t.globalNow()};t.prototype.hasTime=function(e){var t=immutable_class_1.NamedArray.findByName(this.timeTags,e);return Boolean(t&&t.time)};t.prototype.getTime=function(e){var t=immutable_class_1.NamedArray.findByName(this.timeTags,e);if(!t)return this.now();return t.time||this.now()};t.prototype.hasUpdatedSince=function(e,t){var i=immutable_class_1.NamedArray.findByName(this.timeTags,e);if(!i||!i.time)return false;return t<i.updated};t.prototype.addOrUpdateTimeTagFor=function(e,i){if(i===void 0){i=null}var a=this.valueOf();var r=immutable_class_1.NamedArray.findByName(a.timeTags,e);if(r){r=r.changeTime(i,this.now())}else{r=new time_tag_1.TimeTag({name:e,time:i,updated:this.now()})}a.timeTags=immutable_class_1.NamedArray.overrideByName(a.timeTags,r);return new t(a)};t.prototype.getTimeTagsNotUpdatedSince=function(e){return this.timeTags.filter(function(t){return!t.updated||t.updated<e})};t.prototype.getTimeTagsWithoutTime=function(){return this.timeTags.filter(function(e){return!e.time})};t.PROPERTIES=[{name:"timeTags",type:immutable_class_1.PropertyType.ARRAY,immutableClassArray:time_tag_1.TimeTag},{name:"nowOverride",type:immutable_class_1.PropertyType.DATE,defaultValue:null}];return t}(immutable_class_1.BaseImmutable);exports.Timekeeper=Timekeeper;immutable_class_1.BaseImmutable.finalize(Timekeeper);Timekeeper.EMPTY=new Timekeeper({timeTags:[]});