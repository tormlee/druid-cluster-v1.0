"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");var immutable_class_1=require("immutable-class");var split_combine_1=require("../split-combine/split-combine");var splits_1=require("../splits/splits");var base_manifest_1=require("./base-manifest");var GridManifest=function(e){tslib_1.__extends(i,e);function i(){var i=e!==null&&e.apply(this,arguments)||this;i.name="grid";i.title="Grid";return i}i.prototype.canHandleSplitDimensions=function(e,i,t,n){if(i.length===2)return base_manifest_1.Resolve.proceedWithDimensions();var s=e.slice(0,2);var r=function(e){return split_combine_1.SplitCombine.fromDimensionAndFilterAndMeasure(e,t,n)};if(s.length!==2){return base_manifest_1.Resolve.rejectDimensions("Not enough dimensions in this data cube for a Grid",[])}if(!i.length){return base_manifest_1.Resolve.rejectDimensions("The Grid requires two splits",[base_manifest_1.SplitSuggestion.fromTitleAndSplits("splitting on "+s.map(function(e){return e.title}).join(", "),new splits_1.Splits(s.map(r)))])}else if(i.length===1){var l=i[0];var a=e.find(function(e){return!e.equals(l)});if(!a)throw new Error;return base_manifest_1.Resolve.rejectDimensions("The Grid requires two splits",[base_manifest_1.SplitSuggestion.fromTitleAndSplits("adding a split on "+a.title,new splits_1.Splits([r(l),r(a)]))])}else{return base_manifest_1.Resolve.rejectDimensions("Too many splits on the Grid",[base_manifest_1.SplitSuggestion.fromTitleAndSplits("removing all but the first two splits",new splits_1.Splits(s.map(r)))])}};i.prototype.getEffectiveSplits=function(e,i,t){var n=false;var s=e.splitCombines.map(function(e){if(!e.sortAction){n=true;e=e.changeSortAction(split_combine_1.SplitCombine.calculateSortOn(immutable_class_1.NamedArray.findByName(i,e.dimension),t))}if(!e.limitAction){n=true;e=e.changeLimit(25)}return e});return n?new splits_1.Splits(s):e};i.prototype.getSuitability=function(e,i,t,n){var s=i.splitCombines.filter(function(i){return i.getDimension(e).isContinuous()}).length;return new base_manifest_1.Suitability(3+(s>1?6:0))};return i}(base_manifest_1.Manifest);exports.GridManifest=GridManifest;exports.GRID_MANIFEST=new GridManifest;