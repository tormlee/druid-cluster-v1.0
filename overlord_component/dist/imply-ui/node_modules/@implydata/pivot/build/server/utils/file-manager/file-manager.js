"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");var fs=require("fs-extra");var path=require("path");var plywood_1=require("plywood");var parser_1=require("../../../common/utils/parser/parser");var FileManager=function(){function e(e){this.logger=e.logger;this.verbose=Boolean(e.verbose);this.pathResolver=e.pathResolver;this.uri=e.uri;this.subsetExpression=e.subsetExpression;this.verbose=Boolean(e.verbose)}e.getFileData=function(e){return tslib_1.__awaiter(this,void 0,void 0,function(){var r,t;return tslib_1.__generator(this,function(s){switch(s.label){case 0:return[4,fs.readFile(e,"utf-8")];case 1:r=s.sent();try{t=parser_1.parseData(r,path.extname(e))}catch(r){throw new Error("could not parse '"+e+"': "+r.message)}if(t.length&&t[0]["time"]){t.forEach(function(e){e["time"]=new Date(e["time"])})}return[2,t]}})})};e.prototype.loadDataset=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){var r,t,s,a,i,o,n,l;return tslib_1.__generator(this,function(u){switch(u.label){case 0:r=this,t=r.logger,s=r.pathResolver,a=r.uri;i=s(a);t.log("Loading file "+i);u.label=1;case 1:u.trys.push([1,3,,4]);return[4,e.getFileData(i)];case 2:o=u.sent();t.log("Loaded file "+i+" (rows = "+o.length+")");n=plywood_1.Dataset.fromJS(o).hide();if(this.subsetExpression){n=n.filter(this.subsetExpression)}return[2,n];case 3:l=u.sent();t.error("Failed to load file "+i+" because: "+l.message);throw l;case 4:return[2]}})})};return e}();exports.FileManager=FileManager;