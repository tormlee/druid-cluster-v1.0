"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ImmutableFormDelegate=function(){function ImmutableFormDelegate(form){this.form=form;if(!this.form.state)this.form.state={};this.form.state.canSave=false;this.form.state.errors={};this.onChange=this.onChange.bind(this);this.updateErrors=this.updateErrors.bind(this);this.callbacks={}}ImmutableFormDelegate.prototype.on=function(path,callback){var listeners=this.callbacks[path]||[];listeners.push(callback);this.callbacks[path]=listeners};ImmutableFormDelegate.prototype.onAnyChange=function(callback){this.on("*",callback)};ImmutableFormDelegate.prototype.setState=function(state,callback){return this.form.setState.call(this.form,state,callback)};ImmutableFormDelegate.prototype.updateErrors=function(path,isValid,error){var errors=this.form.state.errors;errors[path]=isValid?false:error;var canSave=true;for(var key in errors)canSave=canSave&&errors[key]===false;return{errors:errors,canSave:canSave}};ImmutableFormDelegate.prototype.onChange=function(newItem,isValid,path,error){var _a=this.updateErrors(path,isValid,error),errors=_a.errors,canSave=_a.canSave;if(isValid){this.setState({errors:errors,newInstance:newItem,canSave:canSave},this.callListeners.bind(this,newItem,isValid,path,error))}else{this.setState({errors:errors,canSave:false},this.callListeners.bind(this,newItem,isValid,path,error))}};ImmutableFormDelegate.prototype.callListeners=function(newItem,isValid,path,error){var specificListeners=this.callbacks[path]||[];var wildCardListeners=this.callbacks["*"]||[];var listeners=specificListeners.concat(wildCardListeners);listeners.forEach(function(l){return l(newItem,isValid,path,error)})};return ImmutableFormDelegate}();exports.ImmutableFormDelegate=ImmutableFormDelegate;