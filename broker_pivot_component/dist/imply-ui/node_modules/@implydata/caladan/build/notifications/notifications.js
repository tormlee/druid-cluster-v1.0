"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");var React=require("react");var ReactDOM=require("react-dom");var immutable_class_1=require("immutable-class");var body_portal_1=require("../body-portal/body-portal");var button_1=require("../button/button");var loading_bar_1=require("../loading-bar/loading-bar");var modal_1=require("../modal/modal");var notification_card_1=require("../notification-card/notification-card");var notifier_1=require("../notifier/notifier");function isPromiseAlike(e){return Boolean(e&&typeof e.then==="function")}var Notifications=function(e){tslib_1.__extends(t,e);function t(){var t=e.call(this)||this;t.state={notifications:[]};t.onChange=t.onChange.bind(t);return t}t.prototype.componentDidMount=function(){notifier_1.Notifier.subscribe(this.onChange)};t.prototype.componentWillUnmount=function(){notifier_1.Notifier.unsubscribe(this.onChange)};t.prototype.onChange=function(e){this.setState({notifications:e})};t.prototype.renderCards=function(){var e=13;return this.state.notifications.map(function(t,n){var i=t.title,a=t.message,o=t.action;var r=e;e+=[i,a,o].filter(Boolean).length*30+5;return React.createElement(notification_card_1.NotificationCard,{model:t,key:t.id,top:r})})};t.prototype.render=function(){return React.createElement(body_portal_1.BodyPortal,{left:"50%",top:"10px",isAboveAll:true},React.createElement("div",{className:"notifications"},this.renderCards()))};return t}(React.Component);exports.Notifications=Notifications;var Questions=function(e){tslib_1.__extends(t,e);function t(){var t=e.call(this)||this;t.state={loadingMessages:[]};t.onChange=t.onChange.bind(t);return t}t.prototype.componentDidMount=function(){notifier_1.Notifier.subscribe(this.onChange)};t.prototype.componentWillUnmount=function(){notifier_1.Notifier.unsubscribe(this.onChange)};t.prototype.onChange=function(e,t){this.setState({question:t})};t.prototype.renderButton=function(e,t){var n=this;var i=this.state,a=i.loadingMessages,o=i.question;var r=e.label,s=e.callback,l=e.type,c=e.className,u=e.closeOnClick,m=e.loadingMessage;var d=function(e){if(!e||l!=="primary")return;ReactDOM.findDOMNode(e).focus()};var f=o.id||o.title;var p=function(){if(u)notifier_1.Notifier.removeQuestion();if(s){var e=s();if(isPromiseAlike(e)){var t={name:f,message:m||""};n.setState({loadingMessages:immutable_class_1.NamedArray.overrideByName(a,t)});e.then(function(){return n.setState({loadingMessages:immutable_class_1.NamedArray.overrideByName(a,{name:f,message:null})})})}}};return React.createElement(button_1.Button,{key:t,className:c,title:r,type:l,disabled:immutable_class_1.NamedArray.findByName(a,f)!=null,onClick:p,ref:d})};t.prototype.render=function(){var e=this.state,t=e.question,n=e.loadingMessages;if(!t)return null;var i;if(Array.isArray(t.message)){i=t.message.map(function(e,t){return React.createElement("p",{key:t},e)})}else if(React.isValidElement(t.message)){i=t.message}else{i=React.createElement("p",null,t.message)}var a=immutable_class_1.NamedArray.findByName(n,t.id||t.title);return React.createElement(modal_1.Modal,{className:"question",title:t.title,onClose:t.onClose},i,React.createElement("div",{className:"button-bar"},a!=null?React.createElement(loading_bar_1.LoadingBar,{label:a.message}):t.choices.map(this.renderButton.bind(this))))};return t}(React.Component);exports.Questions=Questions;