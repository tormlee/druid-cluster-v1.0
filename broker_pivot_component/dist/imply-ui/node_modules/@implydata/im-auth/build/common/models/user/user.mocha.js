"use strict";Object.defineProperty(exports,"__esModule",{value:true});var chai_1=require("chai");var immutable_class_tester_1=require("immutable-class-tester");var user_mock_1=require("./user.mock");var user_1=require("./user");var role_1=require("../role/role");describe("User",function(){it("is an immutable class",function(){immutable_class_tester_1.testImmutableClass(user_1.User,[user_mock_1.UserMock.wildcardJS,user_mock_1.UserMock.user2JS,user_mock_1.UserMock.user3JS,{name:"vadim",email:"user3@myusers.com",roles:["super-admin"],favorites:["wikipedia"]},{name:"vadim",email:"user3@myusers.com",roles:["super-admin"],favorites:["wikipedia","twitter"]}])});it("back compat deals with id",function(){var oldJS={id:"cat",email:"cat@cats.com",pass:"catpass"};var user=user_1.User.fromJS(oldJS).toJS();chai_1.expect(user.email).to.equal("cat@cats.com");chai_1.expect(user.name).to.equal("cat")});it("back compat adjusts status",function(){var oldJS={name:"admin@admin.com",email:"admin@admin.com",firstName:"a",lastName:"Admin",permissionType:"admin",status:"passwordReset",hashStrategy:"none"};var user=user_1.User.fromJS(oldJS).toJS();chai_1.expect(user.status).to.equal("ok")});it("back compat adjusts permission type to role",function(){var oldAdmin={name:"admin@admin.com",email:"admin@admin.com",firstName:"a",lastName:"Admin",permissionType:"admin",status:"passwordReset",hashStrategy:"none"};var admin=user_1.User.fromJS(oldAdmin).toJS();chai_1.expect(admin.roles).to.deep.equal(["super-admin"]);var oldUser={name:"admin@admin.com",email:"admin@admin.com",firstName:"a",lastName:"Admin",permissionType:"user",status:"passwordReset",hashStrategy:"none"};var user=user_1.User.fromJS(oldUser).toJS();chai_1.expect(user.roles).to.deep.equal(["user"]);var oldUser2={name:"admin@admin.com",email:"admin@admin.com",firstName:"a",lastName:"Admin",status:"passwordReset",hashStrategy:"none"};var user2=user_1.User.fromJS(oldUser2).toJS();chai_1.expect(user2.roles).to.deep.equal(["user"])});it("can",function(){var js1={name:"admin@admin.com",email:"admin@admin.com",firstName:"a",lastName:"Admin",roles:["file-admin"],status:"passwordReset",hashStrategy:"none"};var accountRoles=[role_1.Role.SUPER_ADMIN,new role_1.Role({name:"file-admin",permissions:[{name:"create-file",value:"*"},{name:"edit-file",value:"*"}]})];var user1=user_1.User.fromJS(js1);chai_1.expect(user1.can("create-file",accountRoles)).to.equal(true);chai_1.expect(user1.can("delete-file",accountRoles)).to.equal(false);var js2={name:"admin@admin.com",email:"admin@admin.com",firstName:"a",lastName:"Admin",roles:["super-admin"],status:"passwordReset",hashStrategy:"none"};var user2=user_1.User.fromJS(js2);chai_1.expect(user2.can("create-file",accountRoles)).to.equal(true);chai_1.expect(user2.can("delete-file",accountRoles)).to.equal(true)})});