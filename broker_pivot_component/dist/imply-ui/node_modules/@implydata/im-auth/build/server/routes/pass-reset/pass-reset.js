"use strict";var _this=this;var tslib_1=require("tslib");var nike_hercules_1=require("@implydata/nike-hercules");var router=nike_hercules_1.HerculesServer.makeRouter();router.post("/",function(req,res,next){return tslib_1.__awaiter(_this,void 0,void 0,function(){var body,authorizer,name,pass,e_1;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:body=req.body,authorizer=req.authorizer;name=body.name,pass=body.pass;if(typeof name!=="string"){res.status(400).send({error:"must have a name"});return[2]}if(typeof pass!=="string"){res.status(400).send({error:"must have a pass"});return[2]}_a.label=1;case 1:_a.trys.push([1,3,,4]);return[4,authorizer.changePassword(name,pass)];case 2:_a.sent();return[3,4];case 3:e_1=_a.sent();nike_hercules_1.LOGGER.log("error: "+e_1.message);if(e_1.hasOwnProperty("stack")){nike_hercules_1.LOGGER.log(e_1.stack)}res.status(500).send({error:"could not update",message:e_1.message});req.tracker.track({type:"pass-reset",metric:"pass-reset/count",value:1,user:null,attr:{success:"false",user_email:name,payload:pass,error:e_1.message}});return[2];case 4:req.tracker.track({type:"pass-reset",metric:"pass-reset/count",value:1,user:null,attr:{success:"true",user_email:name,payload:pass}});res.send({status:"OK"});return[2]}})})});module.exports=router;