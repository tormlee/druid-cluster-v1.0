"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");var caladan_1=require("@implydata/caladan");var immutable_class_1=require("immutable-class");var React=require("react");var classNames=require("classnames");var immutable_utils_1=require("../immutable-utils/immutable-utils");var ImmutableDropdown=function(_super){tslib_1.__extends(ImmutableDropdown,_super);function ImmutableDropdown(){return _super.call(this)||this}ImmutableDropdown.specialize=function(){return ImmutableDropdown};ImmutableDropdown.simpleGenerator=function(instance,changeFn,labels,errors){return function(name,items,focusOnStartUp){if(focusOnStartUp===void 0){focusOnStartUp=false}var MyDropdown=ImmutableDropdown.specialize();var myLabels=immutable_utils_1.getLabel(name,labels);return React.createElement(MyDropdown,{key:"dropdown-"+name,items:items,instance:instance,path:name,equal:immutable_class_1.generalEqual,renderItem:function(a){return a?a.label:""},keyItem:function(a){return a.value||"default_value"},itemToValue:function(a){return a?a.value:""},onChange:changeFn,focusOnStartUp:focusOnStartUp,helpTitle:myLabels.label,helpText:myLabels.description,errorText:errors[name]})}};ImmutableDropdown.prototype.onChange=function(newSelectedItem){var _a=this.props,instance=_a.instance,path=_a.path,onChange=_a.onChange,itemToValue=_a.itemToValue;onChange(immutable_utils_1.setProperty(instance,path,itemToValue(newSelectedItem)),true,path,undefined)};ImmutableDropdown.prototype.onFocus=function(){var _a=this.props,showHelpOnFocus=_a.showHelpOnFocus,path=_a.path,helpTitle=_a.helpTitle,helpText=_a.helpText,errorText=_a.errorText;if(showHelpOnFocus){caladan_1.InfoManager.show({sourceId:path,title:helpTitle,lines:[helpText,errorText].filter(Boolean),type:errorText?"error":"info"})}};ImmutableDropdown.prototype.onBlur=function(){if(this.props.showHelpOnFocus)caladan_1.InfoManager.hide(this.props.path)};ImmutableDropdown.prototype.render=function(){var _a=this.props,label=_a.label,items=_a.items,equal=_a.equal,renderItem=_a.renderItem,keyItem=_a.keyItem,itemToValue=_a.itemToValue,instance=_a.instance,path=_a.path,focusOnStartUp=_a.focusOnStartUp,disabled=_a.disabled,showHelpOnFocus=_a.showHelpOnFocus;var MyDropdown=caladan_1.Dropdown.specialize();var selectedValue=immutable_utils_1.getProperty(instance,path);var selectedItem=immutable_class_1.SimpleArray.find(items,function(item){return equal(itemToValue(item),selectedValue)});return React.createElement(MyDropdown,{className:classNames("immutable-dropdown","input",path,{disabled:disabled}),label:label,items:items,selectedItem:selectedItem,equal:function(a,b){return equal(itemToValue(a),itemToValue(b))},renderItem:renderItem,keyItem:keyItem,onSelect:this.onChange.bind(this),focusOnStartUp:focusOnStartUp,onFocus:showHelpOnFocus?this.onFocus.bind(this):null,onBlur:showHelpOnFocus?this.onBlur.bind(this):null})};return ImmutableDropdown}(React.Component);exports.ImmutableDropdown=ImmutableDropdown;