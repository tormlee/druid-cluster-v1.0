"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");var immutable_class_1=require("immutable-class");var collection_1=require("../collection/collection");var customization_1=require("../customization/customization");var data_cube_1=require("../data-cube/data-cube");var settings_version_1=require("../settings-version/settings-version");var im_auth_1=require("@implydata/im-auth");var beltful_1=require("@implydata/beltful");function checkNamedArrayUnique(e){var t={};for(var a=0,i=e;a<i.length;a++){var r=i[a];var s=r.name;if(t[s])throw new Error("duplicate '"+s+"'");t[s]=1}}var AppSettings=function(e){tslib_1.__extends(t,e);function t(t){var a=e.call(this,t)||this;checkNamedArrayUnique(a.dataCubes);checkNamedArrayUnique(a.collections);return a}t.isAppSettings=function(e){return e instanceof t};t.fromJS=function(e,a){if(a===void 0){a={}}var i=(e.dataCubes||[]).map(function(e){return data_cube_1.DataCube.fromJS(e)});var r={dataCubes:i,visualizations:a.visualizations};var s={version:e.version?settings_version_1.SettingsVersion.fromJS(e.version):null,customization:customization_1.Customization.fromJS(e.customization||{}),numClusters:e.numClusters,dataCubes:i,collections:(e.collections||[]).map(function(e){return collection_1.Collection.fromJS(e,r)}),users:(e.users||[]).map(function(e){return im_auth_1.User.fromJS(e)})};return new t(s)};t.prototype.applyLogoutHref=function(e){var t=this.customization;if(t.logoutHref)return this;return this.changeCustomization(t.changeLogoutHref(e))};t.prototype.getDataCube=function(e){return immutable_class_1.NamedArray.findByName(this.dataCubes,e)};t.prototype.appendDataCubes=function(e){return this.changeDataCubes(immutable_class_1.NamedArray.overridesByName(this.dataCubes,e))};t.prototype.addOrUpdateDataCube=function(e){return this.changeDataCubes(immutable_class_1.NamedArray.overrideByName(this.dataCubes,e))};t.prototype.deleteDataCube=function(e){return this.changeDataCubes(immutable_class_1.NamedArray.deleteByName(this.dataCubes,e))};t.prototype.duplicateDataCube=function(e,t){var a=this;var i=beltful_1.StringUtils.generateAvailableName({isAvailable:function(e){return!a.getDataCube(e)}});return e.makeDuplicate(i,t)};t.prototype.getCollection=function(e){return immutable_class_1.NamedArray.findByName(this.collections,e)};t.prototype.addOrUpdateCollection=function(e){return this.changeCollections(immutable_class_1.NamedArray.overrideByName(this.collections,e))};t.prototype.deleteCollection=function(e){return this.changeCollections(immutable_class_1.NamedArray.deleteByName(this.collections,e))};t.prototype.duplicateCollection=function(e,t){var a=this;var i=beltful_1.StringUtils.generateAvailableName({isAvailable:function(e){return!a.getCollection(e)}});return e.makeDuplicate(i,t)};t.prototype.hasUsers=function(){return Boolean(this.users.length)};t.prototype.constrainToUser=function(e){if(e.isSuperAdmin())return this;var t=this,a=t.dataCubes,i=t.collections;return this.changeMany({dataCubes:a.filter(function(t){return t.getReadAccess().hasAccess(e)}),collections:i.filter(function(t){return t.getReadAccess().hasAccess(e)})})};t.PROPERTIES=[{name:"version",immutableClass:settings_version_1.SettingsVersion,defaultValue:null},{name:"customization",immutableClass:customization_1.Customization},{name:"numClusters",defaultValue:0},{name:"dataCubes",immutableClassArray:data_cube_1.DataCube,type:immutable_class_1.PropertyType.ARRAY},{name:"collections",immutableClassArray:collection_1.Collection,type:immutable_class_1.PropertyType.ARRAY},{name:"users",immutableClassArray:im_auth_1.User,type:immutable_class_1.PropertyType.ARRAY}];return t}(immutable_class_1.BaseImmutable);exports.AppSettings=AppSettings;immutable_class_1.BaseImmutable.finalize(AppSettings);AppSettings.BLANK=AppSettings.fromJS({},{visualizations:[]});