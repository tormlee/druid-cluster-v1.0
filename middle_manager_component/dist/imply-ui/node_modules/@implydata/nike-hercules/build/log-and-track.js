"use strict";Object.defineProperty(exports,"__esModule",{value:true});var morgan=require("morgan");var tracker_1=require("./tracker");function logAndTrack(options){var morganFormat=options.morganFormat,customTokens=options.customTokens;if(customTokens){for(var k in customTokens){morgan.token(k,customTokens[k])}}var morganFormatFunction=morgan.compile(morgan[morganFormat]||morganFormat);var morganHandler=function(tokens,req,res){var trackingEvent={type:"request",attr:{url:tokens["url"](req,res),method:tokens["method"](req,res),status:tokens["status"](req,res)},user:req.user,metric:"request/time",value:Number(tokens["response-time"](req,res))};if(customTokens){for(var k in customTokens){trackingEvent.attr[k]=tokens[k](req,res)}}tracker_1.TRACKER.track(trackingEvent);return morganFormatFunction(tokens,req,res)};return morgan(morganHandler)}exports.logAndTrack=logAndTrack;