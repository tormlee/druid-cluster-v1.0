"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");require("./pass-setter.css");var React=require("react");var classNames=require("classnames");var caladan_1=require("@implydata/caladan");var ajax_1=require("@implydata/ajax");var strings_1=require("../../common/strings");var pass_strength_1=require("../../common/utils/pass-strength/pass-strength");var PassSetter=function(_super){tslib_1.__extends(PassSetter,_super);function PassSetter(){var _this=_super.call(this)||this;_this.state={};return _this}PassSetter.prototype.submitNewPassword=function(event){var _this=this;var _a=this.props,name=_a.name,submitRoute=_a.submitRoute;var value=this.state.value;event.preventDefault();this.setState({loading:true});ajax_1.Ajax.query({url:submitRoute,data:{name:name,pass:value}}).then(function(data){_this.setState({resettingPassword:false,loading:false})},function(e){_this.setState({resettingPassword:false,loading:false})})};PassSetter.prototype.onChange=function(event){var _a=this.props,id=_a.id,passStrengthOpts=_a.passStrengthOpts;var value=event.target.value;var error=new pass_strength_1.PassStrenth(passStrengthOpts).getIssuesWithPass(value);if(error){caladan_1.InfoManager.show({sourceId:id,title:"",lines:[error],type:"error"})}else{caladan_1.InfoManager.hide("pass")}this.setState({value:value,error:error})};PassSetter.prototype.renderInputs=function(){var _this=this;var _a=this.state,error=_a.error,value=_a.value,loading=_a.loading,showingPass=_a.showingPass;var toggleShow=function(){return _this.setState({showingPass:!showingPass})};var buttonTitle=showingPass?"Mask Password":"Show Password";return React.createElement("div",{className:"inputs"},React.createElement("div",{className:"pass-input"},React.createElement("input",{className:classNames({error:!!error}),value:value,onChange:this.onChange.bind(this),type:showingPass?"text":"password"}),React.createElement("div",{className:"row",onClick:toggleShow},React.createElement(caladan_1.Button,{type:"light-action",title:buttonTitle,onClick:toggleShow}))),React.createElement("div",{className:"buttons"},React.createElement(caladan_1.Button,{disabled:loading||!!error||!value,title:strings_1.STRINGS.ok,type:"primary",onClick:this.submitNewPassword.bind(this)}),React.createElement(caladan_1.Button,{type:"secondary",title:strings_1.STRINGS.cancel,onClick:function(){_this.setState({resettingPassword:false,value:null,error:""});caladan_1.InfoManager.hide("pass")}})))};PassSetter.prototype.render=function(){var _this=this;var _a=this.props,label=_a.label,id=_a.id,placeholder=_a.placeholder;var _b=this.state,loading=_b.loading,error=_b.error,resettingPassword=_b.resettingPassword;var content=null;if(loading){content=React.createElement(caladan_1.LoadingBar,{label:"resetting"})}else if(resettingPassword){content=this.renderInputs()}else{content=React.createElement("div",{className:"not-resetting"},placeholder,React.createElement(caladan_1.Button,{type:"secondary",onClick:function(){return _this.setState({resettingPassword:true})},title:"Reset password",className:"reset"}))}return React.createElement("div",{className:"pass-setter"},React.createElement(caladan_1.GlobalEventListener,{escape:function(){return _this.setState({resettingPassword:false})}}),React.createElement(caladan_1.FormLabel,{field:id,label:label||"password",errorText:error,infoId:id}),content)};return PassSetter}(React.Component);exports.PassSetter=PassSetter;