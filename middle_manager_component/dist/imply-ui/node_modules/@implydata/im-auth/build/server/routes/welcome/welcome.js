"use strict";var _this=this;var tslib_1=require("tslib");var nike_hercules_1=require("@implydata/nike-hercules");var user_1=require("../../../common/models/user/user");var router=nike_hercules_1.HerculesServer.makeRouter();router.post("/create",function(req,res,next){return tslib_1.__awaiter(_this,void 0,void 0,function(){var _a,name,firstName,lastName,pass,accountId,user,e_1,e_2;return tslib_1.__generator(this,function(_b){switch(_b.label){case 0:_a=req.body,name=_a.name,firstName=_a.firstName,lastName=_a.lastName,pass=_a.pass,accountId=_a.accountId;if(typeof name!=="string"){res.status(400).send({error:"must have a name"});return[2]}if(typeof pass!=="string"){res.status(400).send({error:"must have a pass"});return[2]}if(req.authorizer.hasAccounts()&&typeof accountId!=="string"){res.status(400).send({error:"must have an account id"});return[2]}user=new user_1.User({name:name,firstName:firstName,lastName:lastName,accountId:accountId,roles:["super-admin"]});_b.label=1;case 1:_b.trys.push([1,3,,4]);return[4,req.authorizer.addOrUpdateUser(user)];case 2:_b.sent();return[3,4];case 3:e_1=_b.sent();res.status(500).send({error:"Could not create user "+e_1.message});return[2];case 4:_b.trys.push([4,6,,7]);return[4,req.authorizer.changePassword(name,pass)];case 5:_b.sent();return[3,7];case 6:e_2=_b.sent();res.status(500).send({error:"Could not set password"+e_2.message});return[2];case 7:req.session.loggedIn=true;req.session.userName=user.name;res.send({status:"ok"});return[2]}})})});module.exports=router;