"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=require("tslib");var immutable_class_1=require("immutable-class");var strings_1=require("../../strings");var role_1=require("../role/role");var DEFAULT_ADMIN_NAME="admin@admin.com";var DEFAULT_ADMIN_PROPERTIES={name:DEFAULT_ADMIN_NAME,email:"admin@admin.com",firstName:"Default",lastName:"Admin",roles:["super-admin"],status:"ok"};var User=function(_super){tslib_1.__extends(User,_super);function User(){return _super!==null&&_super.apply(this,arguments)||this}User.isUser=function(candidate){return candidate instanceof User};User.fromJS=function(parameters){var id=parameters.id;if(id&&!parameters.name){parameters.name=id}if(parameters.status==="passwordReset")parameters.status=User.STATUS_OK;return new User(immutable_class_1.BaseImmutable.jsToValue(User.PROPERTIES,parameters,User.BACK_COMPATS))};User.fromName=function(name){return new User({name:name})};User.prototype.isSuperAdmin=function(){return this.getRoles().includes(role_1.Role.SUPER_ADMIN_NAME)};User.prototype.canAccessSettings=function(){return this.isSuperAdmin()};User.prototype.can=function(permission,accountRoles){if(!accountRoles||!accountRoles.length)accountRoles=[role_1.Role.SUPER_ADMIN,role_1.Role.USER];var myInflatedRoles=this.getRoles().map(function(role){return immutable_class_1.NamedArray.findByName(accountRoles,role)}).filter(Boolean);return myInflatedRoles.some(function(role){return role.can(permission)})||myInflatedRoles.some(function(role){return role.isSuperAdmin()})};User.prototype.getRole=function(){return this.getRoles()[0]};User.prototype.changeRole=function(role){return this.changeRoles([role])};User.prototype.getStatusDisplay=function(){var status=this.getStatus();switch(status){case User.STATUS_INVITATION_LINK:return strings_1.STRINGS.invitationLink;default:return strings_1.STRINGS.ok}};User.prototype.getDisplayName=function(){var _a=this,firstName=_a.firstName,lastName=_a.lastName;if(firstName&&lastName)return firstName+" "+lastName;return firstName||lastName||"???"};User.prototype.equalsByName=function(other){if(!other)return false;return this.name===other.name};User.STATUS_INVITATION_LINK="invitationLink";User.STATUS_NEEDS_TO_SET_PASS="needsToSetPass";User.STATUS_OK="ok";User.STATUSES=[User.STATUS_INVITATION_LINK,User.STATUS_OK,User.STATUS_NEEDS_TO_SET_PASS];User.SUPER_ADMIN_NAME="super-admin";User.BACK_COMPATS=[{condition:function(js){return!js.roles},action:function(js){var oldValue=js.permissionType;js.roles=oldValue==="admin"?["super-admin"]:["user"]}}];User.PROPERTIES=[{name:"name"},{name:"accountId",defaultValue:null},{name:"email",defaultValue:null},{name:"firstName",defaultValue:null},{name:"lastName",defaultValue:null},{name:"status",defaultValue:User.STATUS_OK,possibleValues:User.STATUSES},{name:"roles",defaultValue:[role_1.Role.USER.name],preserveUndefined:true},{name:"favorites",type:immutable_class_1.PropertyType.ARRAY}];return User}(immutable_class_1.BaseImmutable);exports.User=User;immutable_class_1.BaseImmutable.finalize(User);User.DEFAULT_ADMIN=new User(DEFAULT_ADMIN_PROPERTIES);User.DEFAULT_ADMIN_NAME=User.DEFAULT_ADMIN.name;